"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[590],{3227:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"notebooks/stomatal-conductance-analysis","title":"Community Notebook: Stomatal Conductance Analysis with PhyTorch","description":"This notebook demonstrates fitting stomatal conductance models to understand plant water use efficiency and stomatal behavior.","source":"@site/docs/notebooks/stomatal-conductance-analysis.md","sourceDirName":"notebooks","slug":"/notebooks/stomatal-conductance-analysis","permalink":"/docs/notebooks/stomatal-conductance-analysis","draft":false,"unlisted":false,"editUrl":"https://github.com/PlantSimulationLab/phytorch/tree/main/website/docs/notebooks/stomatal-conductance-analysis.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Community Notebook: Photosynthesis Analysis with PhyTorch","permalink":"/docs/notebooks/photosynthesis-analysis"},"next":{"title":"API Reference","permalink":"/docs/api/"}}');var i=t(4848),s=t(8453);const l={sidebar_position:2},o="Community Notebook: Stomatal Conductance Analysis with PhyTorch",r={},d=[{value:"Overview",id:"overview",level:2},{value:"Load and Prepare Data",id:"load-and-prepare-data",level:2},{value:"Fit Multiple Stomatal Conductance Models",id:"fit-multiple-stomatal-conductance-models",level:2},{value:"Visualize Model Performance",id:"visualize-model-performance",level:2},{value:"Stomatal Response to VPD",id:"stomatal-response-to-vpd",level:2},{value:"Calculate Intrinsic Water Use Efficiency (iWUE)",id:"calculate-intrinsic-water-use-efficiency-iwue",level:2},{value:"Key Insights",id:"key-insights",level:2},{value:"Model Selection",id:"model-selection",level:3},{value:"Biological Interpretation",id:"biological-interpretation",level:3},{value:"Stomatal Limitations to Photosynthesis",id:"stomatal-limitations-to-photosynthesis",level:3},{value:"Model Comparison Table",id:"model-comparison-table",level:2},{value:"Recommendations",id:"recommendations",level:2},{value:"Limitations",id:"limitations",level:2},{value:"References",id:"references",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"community-notebook-stomatal-conductance-analysis-with-phytorch",children:"Community Notebook: Stomatal Conductance Analysis with PhyTorch"})}),"\n",(0,i.jsx)(n.p,{children:"This notebook demonstrates fitting stomatal conductance models to understand plant water use efficiency and stomatal behavior."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": Compare different stomatal conductance models (Medlyn, Ball-Woodrow-Berry, Buckley-Mott-Farquhar) and their ability to predict stomatal responses to environmental conditions"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Dataset"}),": LI-COR 6800 measurements across a range of VPD and light conditions"]}),"\n",(0,i.jsx)(n.h2,{id:"load-and-prepare-data",children:"Load and Prepare Data"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from phytorch import fit\nfrom phytorch.models.stomatal import MED2011, BWB1987, BMF2003\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom scipy import stats\n\n# Load stomatal conductance data\ndf = pd.read_csv('data/stomatal_measurements.csv')\n\n# Prepare data dictionary\ndata = {\n    'A': df['Photo'].values,\n    'VPD': df['VPD'].values,\n    'Ca': df['Ca'].values,\n    'gs': df['Cond'].values\n}\n\nprint(f\"Loaded {len(df)} measurements\")\nprint(f\"VPD range: {data['VPD'].min():.2f} - {data['VPD'].max():.2f} kPa\")\nprint(f\"gs range: {data['gs'].min():.3f} - {data['gs'].max():.3f} mol/m\xb2/s\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"fit-multiple-stomatal-conductance-models",children:"Fit Multiple Stomatal Conductance Models"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Define models to compare\nmodels = {\n    'MED': (MED2011(), 'Medlyn (USO)'),\n    'BWB': (BWB1987(), 'Ball-Woodrow-Berry'),\n    'BMF': (BMF2003(), 'Buckley-Mott-Farquhar')\n}\n\nresults = {}\n\n# Fit each model\nfor model_key, (model, model_name) in models.items():\n    print(f\"\\nFitting {model_name} model...\")\n\n    # Fit model using scipy optimizer\n    result = fit(model, data)\n\n    # Calculate RMSE\n    rmse = np.sqrt(np.mean(result.residuals**2))\n\n    # Store results\n    results[model_key] = {\n        'model': model,\n        'result': result,\n        'r2': result.r_squared,\n        'rmse': rmse\n    }\n\n    print(f\"  R\xb2 = {result.r_squared:.3f}\")\n    print(f\"  RMSE = {rmse:.4f} mol/m\xb2/s\")\n\n    # Print fitted parameters\n    if model_key == 'MED':\n        print(f\"  g0 = {result.parameters['g0']:.4f} mol/m\xb2/s\")\n        print(f\"  g1 = {result.parameters['g1']:.2f}\")\n    elif model_key == 'BWB':\n        print(f\"  g0 = {result.parameters['g0']:.4f} mol/m\xb2/s\")\n        print(f\"  g1 = {result.parameters['g1']:.2f}\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"visualize-model-performance",children:"Visualize Model Performance"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"fig, axes = plt.subplots(1, 3, figsize=(15, 5))\n\nfor idx, (model_key, (_, model_name)) in enumerate(models.items()):\n    ax = axes[idx]\n\n    observed = data['gs']\n    predicted = results[model_key]['result'].predictions\n    r2 = results[model_key]['r2']\n    rmse = results[model_key]['rmse']\n\n    # 1:1 plot\n    ax.scatter(observed, predicted, alpha=0.5, s=40)\n\n    # 1:1 line\n    min_val = min(observed.min(), predicted.min())\n    max_val = max(observed.max(), predicted.max())\n    ax.plot([min_val, max_val], [min_val, max_val], 'r--', linewidth=2, label='1:1')\n\n    ax.set_xlabel('Observed gs (mol/m\xb2/s)', fontsize=11)\n    ax.set_ylabel('Predicted gs (mol/m\xb2/s)', fontsize=11)\n    ax.set_title(f\"{model_name}\\nR\xb2 = {r2:.3f}, RMSE = {rmse:.4f}\",\n                 fontsize=11, fontweight='bold')\n    ax.legend()\n    ax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.savefig('model_comparison.png', dpi=300, bbox_inches='tight')\nplt.show()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"stomatal-response-to-vpd",children:"Stomatal Response to VPD"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Analyze gs response to VPD using the best model (e.g., Medlyn)\nbest_model = 'MED'\npredicted = results[best_model]['result'].predictions\n\n# Bin data by VPD\nvpd_bins = np.linspace(data['VPD'].min(), data['VPD'].max(), 10)\nvpd_centers = (vpd_bins[:-1] + vpd_bins[1:]) / 2\n\ngs_mean = []\ngs_std = []\n\nfor i in range(len(vpd_bins)-1):\n    mask = (data['VPD'] >= vpd_bins[i]) & (data['VPD'] < vpd_bins[i+1])\n    gs_mean.append(data['gs'][mask].mean())\n    gs_std.append(data['gs'][mask].std())\n\n# Plot gs vs VPD\nfig, ax = plt.subplots(figsize=(10, 6))\n\n# Scatter plot of all data\nax.scatter(data['VPD'], data['gs'], alpha=0.3, s=30, label='Observed', color='blue')\n\n# Binned means with error bars\nax.errorbar(vpd_centers, gs_mean, yerr=gs_std, fmt='o-', linewidth=2,\n            markersize=8, capsize=5, label='Binned mean \xb1 SD', color='red')\n\n# Model prediction across VPD range\nvpd_range = np.linspace(data['VPD'].min(), data['VPD'].max(), 100)\n# Note: This would require generating predictions at different VPD values\n# with constant A and other conditions\n\nax.set_xlabel('VPD (kPa)', fontsize=12)\nax.set_ylabel('gs (mol/m\xb2/s)', fontsize=12)\nax.set_title('Stomatal Conductance Response to VPD', fontsize=14, fontweight='bold')\nax.legend()\nax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.savefig('gs_vpd_response.png', dpi=300, bbox_inches='tight')\nplt.show()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"calculate-intrinsic-water-use-efficiency-iwue",children:"Calculate Intrinsic Water Use Efficiency (iWUE)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# iWUE = A/gs\n# Higher iWUE indicates more carbon gained per unit water lost\n\ndf['iWUE'] = df['Photo'] / df['Cond']  # \u03bcmol CO2 / mol H2O\n\n# Plot iWUE vs VPD\nfig, ax = plt.subplots(figsize=(10, 6))\n\nax.scatter(df['VPD'], df['iWUE'], alpha=0.5, s=50)\n\n# Fit linear regression\nslope, intercept, r_value, p_value, std_err = stats.linregress(df['VPD'], df['iWUE'])\n\n# Plot regression line\nvpd_range = np.linspace(df['VPD'].min(), df['VPD'].max(), 100)\nax.plot(vpd_range, slope * vpd_range + intercept, 'r-', linewidth=2,\n        label=f'Linear fit: R\xb2 = {r_value**2:.3f}, p = {p_value:.4f}')\n\nax.set_xlabel('VPD (kPa)', fontsize=12)\nax.set_ylabel('iWUE (\u03bcmol CO\u2082 / mol H\u2082O)', fontsize=12)\nax.set_title('Intrinsic Water Use Efficiency vs VPD', fontsize=14, fontweight='bold')\nax.legend()\nax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.savefig('iwue_vpd.png', dpi=300, bbox_inches='tight')\nplt.show()\n\nprint(f\"\\niWUE Statistics:\")\nprint(f\"  Mean iWUE: {df['iWUE'].mean():.2f} \xb1 {df['iWUE'].std():.2f}\")\nprint(f\"  Slope with VPD: {slope:.2f} (p = {p_value:.4f})\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"key-insights",children:"Key Insights"}),"\n",(0,i.jsx)(n.h3,{id:"model-selection",children:"Model Selection"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Medlyn Model (MED)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Uses VPD directly in formulation"}),"\n",(0,i.jsx)(n.li,{children:"Generally performs well across species"}),"\n",(0,i.jsx)(n.li,{children:"The g1 parameter reflects stomatal sensitivity to VPD"}),"\n",(0,i.jsx)(n.li,{children:"Typical g1 values: 2-8 for C3 plants"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ball-Woodrow-Berry (BWB)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Uses relative humidity"}),"\n",(0,i.jsx)(n.li,{children:"Historically important model"}),"\n",(0,i.jsx)(n.li,{children:"May perform less well at extreme VPD"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Buckley-Mott-Farquhar (BMF)"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"More mechanistic, optimization-based"}),"\n",(0,i.jsx)(n.li,{children:"Can provide insights into stomatal optimization strategy"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"biological-interpretation",children:"Biological Interpretation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Extract g1 from Medlyn model\ng1 = results[\'MED\'][\'result\'].parameters[\'g1\']\ng0 = results[\'MED\'][\'result\'].parameters[\'g0\']\n\nprint(f"\\nMedlyn Model Parameters:")\nprint(f"  g0 (residual conductance): {g0:.4f} mol/m\xb2/s")\nprint(f"  g1 (stomatal sensitivity): {g1:.2f}")\n\n# Interpret g1\nif g1 < 3:\n    interpretation = "Water-conservative strategy (low sensitivity to VPD)"\nelif g1 > 6:\n    interpretation = "Water-spending strategy (high sensitivity to VPD)"\nelse:\n    interpretation = "Intermediate strategy"\n\nprint(f"  Interpretation: {interpretation}")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"stomatal-limitations-to-photosynthesis",children:"Stomatal Limitations to Photosynthesis"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Calculate stomatal limitation\n# l_s = (Ca - Ci) / Ca\n\n# Note: Ci would need to be in the dataset - assuming it's available\nif 'Ci' in df.columns:\n    df['stomatal_limitation'] = (df['Ca'] - df['Ci']) / df['Ca']\n\n    print(f\"\\nStomatal Limitation:\")\n    print(f\"  Mean: {df['stomatal_limitation'].mean():.3f}\")\n    print(f\"  Range: {df['stomatal_limitation'].min():.3f} - {df['stomatal_limitation'].max():.3f}\")\n\n    # Higher values indicate greater stomatal limitation\n    if df['stomatal_limitation'].mean() > 0.3:\n        print(\"  \u26a0 Substantial stomatal limitation detected\")\n        print(\"    Consider if water stress is present\")\nelse:\n    print(\"\\nNote: Ci data not available in dataset for stomatal limitation calculation\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"model-comparison-table",children:"Model Comparison Table"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Create summary table\nsummary = pd.DataFrame({\n    'Model': [model_name for _, model_name in models.values()],\n    'R\xb2': [results[m]['r2'] for m in results.keys()],\n    'RMSE': [results[m]['rmse'] for m in results.keys()]\n})\n\nprint(\"\\nModel Performance Summary:\")\nprint(summary.to_string(index=False))\n\n# Identify best model\nbest_idx = summary['R\xb2'].idxmax()\nprint(f\"\\nBest performing model: {summary.loc[best_idx, 'Model']}\")\n"})}),"\n",(0,i.jsx)(n.h2,{id:"recommendations",children:"Recommendations"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"For drought studies"}),": Use Medlyn model with g1 as indicator of drought response"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"For WUE analysis"}),": Calculate iWUE and examine relationship with environmental factors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"For breeding programs"}),": Select for optimal g1 values balancing carbon gain and water loss"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"For modeling"}),": Consider temperature effects on gs (currently not included in basic models)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Models assume steady-state conditions"}),"\n",(0,i.jsx)(n.li,{children:"Dynamic stomatal responses (stomatal kinetics) not captured"}),"\n",(0,i.jsx)(n.li,{children:"Hydraulic signals and hormonal controls not explicitly modeled"}),"\n",(0,i.jsx)(n.li,{children:"Temperature effects on gs parameters may need consideration"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Medlyn, B. E., et al. (2011). Reconciling the optimal and empirical approaches to modelling stomatal conductance. ",(0,i.jsx)(n.em,{children:"Global Change Biology"}),", 17(6), 2134-2144."]}),"\n",(0,i.jsxs)(n.li,{children:["Ball, J. T., Woodrow, I. E., & Berry, J. A. (1987). A model predicting stomatal conductance. ",(0,i.jsx)(n.em,{children:"Progress in Photosynthesis Research"}),", 4, 221-224."]}),"\n",(0,i.jsxs)(n.li,{children:["Buckley, T. N., Mott, K. A., & Farquhar, G. D. (2003). A hydromechanical and biochemical model of stomatal conductance. ",(0,i.jsx)(n.em,{children:"Plant, Cell & Environment"}),", 26(10), 1767-1785."]}),"\n",(0,i.jsx)(n.li,{children:"Lei, T., Rizzo, K. T., & Bailey, B. N. (2025). PhoTorch: a robust and generalized biochemical photosynthesis model fitting package."}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var a=t(6540);const i={},s=a.createContext(i);function l(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);